# tcp长连接服务
    
## 1.基本信息
- 域名:dev.huayinghealth.com 或者ip(120.76.47.120)
- 端口:9292
- 通信协议:包长+包体
包体为json格式数据.包长为固定四个字节16进制数.
举例:    `0045{"id":"13112345679","cmd":"tk","imei":"123456789012349","info":"123"}`

- 解释:id为app帐号(一般为注册的手机号);cmd为控制命令(比如'ping','tk');imei为控制的手表imei;info为内容

## 2.心跳保持
- app连上服务器后为保持长连接需要采用定时发送心跳包.(建议1到2分钟发送一次)
- 心跳包内容:`0021{"id":"13112345679","cmd":"ping"}`
- app发送心跳包后服务器会回复相同内容的心跳包
- 如若没有收到服务端的心跳包,则可认为当前链接已经断开,就需要主动重新连接
    
## 3.微聊
### 1.手表有新语音消息时
-   服务端 发送:`0028{"id":"13112345679","cmd":"TK","info":1}`
-   app收到后就需要调用[rest api中的获取新消息列表api 19.获取新微聊信息列表](http://api.huayinghealth.com/doc/watch/watchapi.html) 
-   无需回复服务器

### 2.app主动发语音给手表时:
- app发送:`0045{"id":"13112345679","cmd":"tk","imei":"123456789012349","info":"123"}`
- id:自身帐号(手机号);cmd:tk(代表微聊消息);imei:发送的手表imei号;info:语音内容
- 发送不成功:手表不在线,服务端返回`0049{"id":"13112345679","cmd":"tk","imei":"123456789012349","info":"offline"}`
- 发送成功:手表在线,服务端返回`0049{"id":"13112345679","cmd":"tk","imei":"123456789012349","info":"ok"}`




    
